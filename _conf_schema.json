{
  "api_url": {
    "description": "Gemini/OpenAI兼容基地址",
    "type": "string",
    "hint": "中转站也支持",
    "default": ""
  },
  "api_key": {
    "description": "API 密钥",
    "type": "string",
    "hint": "",
    "default": "",
    "obvious_hint": true
  },
  "model": {
    "description": "模型ID",
    "type": "string",
    "hint": "模型一定要支持语音识别",
    "default": ""
  },

  "debug_mode": {
    "description": "调试模式",
    "type": "bool",
    "hint": "开启后输出详细日志（URL、识别长度、转发预览等）",
    "default": false
  },
  "enable_voice": {
    "description": "启用语音处理",
    "type": "bool",
    "hint": "关闭后插件不处理任何语音消息",
    "default": true
  },

  "enable_group_voice": {
    "description": "启用群聊语音",
    "type": "bool",
    "hint": "关闭时仅处理私聊语音",
    "default": false
  },
  "group_voice_whitelist": {
    "description": "群聊白名单",
    "type": "list",
    "hint": "群号字符串列表；留空表示不限制。示例: [\"123456\", \"789012\"]",
    "default": []
  },

  "stop_other_handlers": {
    "description": "是否阻止后续插件继续处理原语音事件",
    "type": "bool",
    "hint": "建议开启，避免同一条语音被二次处理导致双回复",
    "default": false
  },
  "stop_event_timing": {
    "description": "拦截时机",
    "type": "string",
    "options": ["before_stt", "after_stt", "never"],
    "hint": "before_stt=识别前拦截；after_stt=识别成功后拦截；never=不拦截（推荐）",
    "default": "never"
  },
  "on_stt_fail": {
    "description": "识别失败策略",
    "type": "string",
    "options": ["pass", "block", "notify", "notify_pass"],
    "hint": "pass=放行；block=拦截静默；notify=拦截并提示；notify_pass=提示后放行（推荐）",
    "default": "notify_pass"
  },

  "output_mode": {
    "description": "输出模式",
    "type": "string",
    "options": ["simple", "rich"],
    "hint": "simple=仅原话转写；rich=附语言/语气/环境音/大意",
    "default": "simple"
  },
  "attach_voice_marker": {
    "description": "是否附加语音来源标记",
    "type": "bool",
    "hint": "开启后会附加“来自语音转写”的提示语",
    "default": true
  },
  "attach_speaker_meta": {
    "description": "是否附加说话人身份信息",
    "type": "bool",
    "hint": "开启后附加昵称/ID/群ID/平台，便于框架判断“谁在说话”",
    "default": true
  },
  "show_transcript": {
    "description": "是否先回显识别结果",
    "type": "bool",
    "hint": "调试用；生产建议关闭，避免多一条中间消息",
    "default": false
  },

  "enable_model_normalize": {
    "description": "启用模型名清洗",
    "type": "bool",
    "hint": "自动去掉站点前缀、[标签]、models/ 等",
    "default": true
  },
  "enable_transcript_clean": {
    "description": "启用转写文本清洗",
    "type": "bool",
    "hint": "自动去多余空行并截断过长文本",
    "default": true
  },
  "max_transcript_chars": {
    "description": "转写文本最大长度",
    "type": "int",
    "hint": "超出后自动截断，防止过长内容影响框架处理",
    "default": 2000
  },

  "voice_instruction": {
    "description": "自定义语音识别提示词",
    "type": "text",
    "hint": "留空则按输出模式自动生成提示词",
    "default": ""
  },

  "ffmpeg_path": {
    "description": "FFmpeg 路径",
    "type": "string",
    "hint": "留空则使用系统环境变量中的 ffmpeg",
    "default": ""
  },
  "max_audio_mb": {
    "description": "语音大小上限(MB)",
    "type": "int",
    "hint": "超过限制将拒绝处理，防止超大文件导致超时",
    "default": 20
  },
  "timeout_sec": {
    "description": "请求超时秒数",
    "type": "int",
    "hint": "包含远程下载与模型请求超时",
    "default": 120
  },
  "retry_times": {
    "description": "请求重试次数",
    "type": "int",
    "hint": "对 5xx/429/网络异常重试，建议 1~3",
    "default": 2
  },

  "voice_file_wait_sec": {
    "description": "本地语音文件等待秒数",
    "type": "int",
    "hint": "容器/慢磁盘场景下等待语音文件落盘，建议 5~15",
    "default": 10
  },
  "enable_get_record_fallback": {
    "description": "启用 get_record 兜底",
    "type": "bool",
    "hint": "本地路径不存在时，尝试通过 NapCat get_record 获取可读音频",
    "default": true
  },
  "allow_napcat_local_record_url": {
    "description": "允许 NapCat 回环地址语音URL",
    "type": "bool",
    "hint": "当 block_private_network=true 时，是否允许 127.0.0.1/localhost/::1 的 get_record URL",
    "default": true
  },

  "use_current_conversation": {
    "description": "是否绑定当前会话ID与conversation转发给框架",
    "type": "bool",
    "hint": "开启可增强与当前人格/记忆链路一致性（推荐开启）",
    "default": true
  },
  "use_framework_tool_manager": {
    "description": "request_llm 时是否传入框架工具管理器",
    "type": "bool",
    "hint": "开启可让框架工具链可用；若出现兼容问题可关闭排查",
    "default": true
  },

  "allow_remote_audio_url": {
    "description": "是否允许下载远程语音URL",
    "type": "bool",
    "hint": "默认关闭以降低安全风险（SSRF）",
    "default": false
  },
  "remote_audio_domain_whitelist": {
    "description": "远程语音域名白名单",
    "type": "list",
    "hint": "allow_remote_audio_url=true时生效；留空表示不限制（不推荐）",
    "default": []
  },
  "block_private_network": {
    "description": "是否拦截内网/本地地址",
    "type": "bool",
    "hint": "建议开启，防止访问 127.0.0.1/10.x/192.168.x/169.254.x 等",
    "default": true
  },
  "strict_local_path_check": {
    "description": "启用本地语音路径白名单校验",
    "type": "bool",
    "hint": "建议开启，仅允许读取指定目录下音频文件",
    "default": true
  },
  "local_audio_allowed_dirs": {
    "description": "本地语音允许目录",
    "type": "list",
    "hint": "示例: [\"/tmp\", \"data\", \"data/temp\"]；严格模式下仅允许这些目录",
    "default": ["data", "data/temp"]
  },

  "enable_temp_cleanup": {
    "description": "启用临时文件清理",
    "type": "bool",
    "hint": "清理插件生成的 gsv_ 临时音频文件",
    "default": true
  },
  "temp_cleanup_on_start": {
    "description": "启动/重载时自动清理",
    "type": "bool",
    "hint": "插件加载后先清一遍历史残留临时文件",
    "default": true
  },
  "temp_cleanup_interval_sec": {
    "description": "定时清理间隔(秒)",
    "type": "int",
    "hint": "0 表示关闭定时清理；建议 600~3600",
    "default": 1800
  },
  "temp_cleanup_max_age_sec": {
    "description": "定时清理文件最小年龄(秒)",
    "type": "int",
    "hint": "只清理超过该年龄的临时文件，避免删到刚生成文件",
    "default": 300
  },
  "temp_cleanup_on_terminate": {
    "description": "插件卸载时清理",
    "type": "bool",
    "hint": "插件 terminate 时再清一次临时文件",
    "default": true
  }
}
